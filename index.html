<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diablo4 Loot Filter File Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://unpkg.com/slim-select@latest/dist/slimselect.css" rel="stylesheet"></link>
</head>
<body>
    <div id="app" x-data="d4data" class="container">
        <h1>Diablo4 Loot Filter File Builder</h1>
        <p class="action">
            <button class="btn btn-warning btn-sm" @click="clearItems()">Clear</button>
        </p>
        <div>
            <textarea cols="30" rows="10" class="form-control" x-text="contentFile()"></textarea>
        </div>
        <h1>Affixes :</h1>
        <p>
            <button class="btn btn-primary" @click="addNewItem()">Add New Item</button>
        </p>
        <div class="row">
            <template x-for="(item, key) in myList" x-key="JSON.stringify(item)">
                <div class="col-md-4 card">
                    <div class="card-body">
                        <div class="mb-1">
                            <input type="text" x-model="item.name" class="form-control form-control-sm" placeholder="Name" @keyup="saveList">
                        </div>
                        <div class="mb-1">
                            <select x-model="item.itemType" multiple placeholder="Choose one or several item type" @change="saveList">
                                <template x-for="itemType in itemTypes">
                                    <option :value="itemType" x-text="itemType" :selected="item.itemType.indexOf(itemType) != -1"></option>
                                </template>
                            </select>
                        </div>
                        <div class="mb-1">
                            <input type="number" class="form-control form-control-sm" x-model="item.minPower" placeholder="Min Power" @change="saveList">
                        </div>
                        <template x-for="(affix, affixKey) in item.affixPools">
                            <div class="row">
                                <div class="col-2 align-self-center">
                                    <button class="btn btn-sm btn-danger" @click="removeAffix(key, affixKey)">X</button>
                                </div>
                                <div class="col-10">
                                    <div class="mb-1">
                                        <select placeholder="Choose an affix" x-model="item.affixPools[affixKey].affix" @change="saveList">
                                            <option data-placeholder="true"></option>
                                            <template x-for="affixListKey in Object.keys(affixes)">
                                                <option :value="affixListKey" x-text="affixes[affixListKey]" :selected="affixListKey == affix.affix"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div class="mb-1">
                                        <input type="text" x-model="item.affixPools[affixKey].value" class="form-control form-control-sm" placeholder="Affix value" @keyup="saveList">
                                    </div>
                                </div>
                            </div>
                        </template>
                        <div class="mb-1 text-end" x-show="item.affixPools.length < 4">
                            <button class="btn btn-info btn-sm" @click="addAffix(key)">Add Affix</button>
                        </div>
                        <div class="mb-1">
                            <input type="text" class="form-control form-control-sm" placeholder="Minimum affix" x-model="item.minAffixCount">
                        </div>
                        <div class="mb-1">
                            <button class="btn btn-info btn-danger btn-sm" @click="removeItem(key)">
                                Remove
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>
    <script src="app.js"></script>
</body>
</html>