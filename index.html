<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Diablo4 Loot Filter File Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://unpkg.com/slim-select@latest/dist/slimselect.css" rel="stylesheet"></link>
</head>
<body>
    <div id="app" x-data="d4data" class="container">
        <h1>Diablo4 Loot Filter File Builder</h1>
        <div class="row">
            <div class="col-10">
                <div class="row">
                <template x-for="(build, buildIndex) in myList" x-key="build.id">
                    <div class="col-2">
                        <button type="button" class="btn btn-sm btn-info" x-text="build.name" @click="changeBuild(buildIndex)" x-show="activeBuild != buildIndex"></button>
                        <div class="input-group">
                            <input type="text" x-show="activeBuild == buildIndex" class="form-control form-control-sm" :disabled="buildIndex != activeBuild" x-model="build.name" @change="saveList()">
                            <template x-if="myList.length > 1 && buildIndex == activeBuild">
                                <button type="button" class="btn btn-light btn-sm" @click="removeBuild(buildIndex)">⛔</button>
                            </template>
                        </div>
                    </div>
                </template>
                    <div class="col-2">
                        <button type="button" class="btn btn-sm btn-primary" @click="addBuild()">➕ Add build</button>
                    </div>
                </div>
            </div>
            <div class="col-2 text-end">
                <button type="button" class="btn btn-sm btn-danger" @click="toggleValidatingBtn($el)">⚠️ Remove all builds</button>
                <button type="button" class="btn btn-sm btn-outline-danger d-none" @click="removeAllBuilds($el)">I'm sure !</button>
                <button type="button" class="btn btn-sm btn-outline-danger d-none" @click="toggleValidatingBtn($el)">Nooo !</button>
            </div>
        </div>
        <hr>
        <div class="action row">
            <div class="col-10">
                Current build : <span class="" x-text="myList[activeBuild].name"></span>
            </div>
            <div class="col-2 text-end">
                <button type="button" class="btn btn-sm btn-danger" @click="toggleValidatingBtn($el)">⚠️ Clear build</button>
                <button type="button" class="btn btn-sm btn-outline-danger d-none" @click="clearBuild($el)">I'm sure !</button>
                <button type="button" class="btn btn-sm btn-outline-danger d-none" @click="toggleValidatingBtn($el)">Nooo !</button>
            </div>
        </div>
        <hr>
        <div>
            <h4>Content File :
                <button type="button" class="btn btn-sm" @click="showContentFile = !showContentFile" x-text="showContentFile ? '⏫' : '⏬'"></button>
            </h4>
            <div x-show="showContentFile" class="text-end">
                <button type="button" class="btn btn-info" @click="copyContentFile()">Copy</button>
                <textarea cols="30" rows="3" class="form-control" x-text="contentFile()"></textarea>
            </div>
        </div>
        <hr>
        <h4>Affixes :
            <button type="button" class="btn btn-sm" x-text="showAffixes ? '⏫' : '⏬'" @click="showAffixes = !showAffixes"></button>
        </h4>
        <p x-show="showAffixes">
            <button class="btn btn-primary" @click="addNewItem()">Add New Item</button>
        </p>
        <div class="row gy-2 gx-4" x-show="showAffixes">
            <template x-for="(item, key) in myList[activeBuild].affixes" :key="item.id">
                <div class="col-md-4">
                    <div class="border border-primary-subtle p-2 rounded">
                        <div class="mb-1">
                            <input type="text" x-model="item.name" class="form-control form-control-sm border-info-subtle" placeholder="Name" @keyup="saveList">
                        </div>
                        <div class="mb-1">
                            <select x-model="item.itemType" multiple placeholder="Choose one or several item type" @change="saveList" class="border-info-subtle">
                                <template x-for="itemType in itemTypes">
                                    <option :value="itemType" x-text="itemType" :selected="item.itemType.indexOf(itemType) != -1"></option>
                                </template>
                            </select>
                        </div>
                        <div class="mb-1">
                            <input type="number" class="form-control form-control-sm border-info-subtle" x-model="item.minPower" placeholder="Min Power" @change="saveList">
                        </div>
                        <template x-for="(affix, affixKey) in item.affixPools" :key="affix.id">
                            <div class="row">
                                <div class="col-2 align-self-center">
                                    <button class="btn btn-sm" @click="removeAffix(key, affixKey)">⛔</button>
                                </div>
                                <div class="col-10">
                                    <div class="mb-1">
                                        <select placeholder="Choose an affix" x-model="item.affixPools[affixKey].affix" @change="saveList" class="border-warning-subtle">
                                            <option data-placeholder="true"></option>
                                            <template x-for="affixListKey in Object.keys(affixes)">
                                                <option :value="affixListKey" x-text="affixes[affixListKey]" :selected="affixListKey == affix.affix"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div class="mb-1">
                                        <input type="number" x-model="item.affixPools[affixKey].value" class="form-control form-control-sm border-warning-subtle" placeholder="Affix value" @keyup="saveList">
                                    </div>
                                </div>
                            </div>
                        </template>
                        <div class="mb-1 text-end">
                            <button class="btn btn-info btn-sm" @click="addAffix(key)">Add Affix</button>
                        </div>
                        <div class="mb-1">
                            <input type="text" class="form-control form-control-sm border-info-subtle" placeholder="Minimum affix" x-model="item.minAffixCount">
                        </div>
                        <div class="mb-1">
                            <button class="btn btn-info btn-danger btn-sm" @click="removeItem(key)">
                                Remove
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
        <hr>
        <h4>Aspects :
            <button type="button" class="btn btn-sm" x-html="showAspects ? '⏫' : '⏬'" @click="showAspects = !showAspects"></button>
        </h4>
        <div class="row mb-5" x-show="showAspects">
            <p>
                <button class="btn btn-primary" @click="addAspect()">Add Aspect</button>
            </p>
            <template x-for="(item, key) in myList[activeBuild].aspects" x-key="JSON.stringify(item)">
                <div class="col-md-4 card">
                    <div class="card-body">
                        <div class="mb-1">
                            <div class="input-group">
                                <select name="form-control" placeholder="Choose an aspect" x-model="item.aspect" @change="saveList()">
                                    <option data-placeholder="true"></option>
                                    <template x-for="aspectListKey in Object.keys(aspects)">
                                        <option :value="aspectListKey" x-text="aspectListKey + ' : ' + aspects[aspectListKey].desc" :selected="aspectListKey == item.aspect"></option>
                                    </template>
                                </select>
                                <input type="text" x-model="item.value" class="form-control" placeholder="Aspect value" @change="saveList()" />
                                <button class="btn btn-outline-secondary" type="button" @click="removeAspect(key)">⛔</button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/slim-select@latest/dist/slimselect.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
